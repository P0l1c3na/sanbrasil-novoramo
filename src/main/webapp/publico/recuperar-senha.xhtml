<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Recuperação de Senha</title>
    <h:outputStylesheet library="css" name="/bootstrap/dist/css/bootstrap-grid.min.css"/>
    <h:outputStylesheet library="css" name="/styleCadastroUsuario.css"/>
    <h:outputStylesheet library="webjars" name="font-awesome/5.12.0/css/all.min-jsf.css"/>
    <h:outputStylesheet library="webjars" name="font-awesome/5.12.0/css/v4-shims.min-jsf.css"/>
</h:head>

<f:view>
    <h:form styleClass="container">

        <p:card styleClass="row d-flex justify-content-center align-content-center mt-5" rendered="#{!recuperacaoSenhaForm.enviouCodigo}">

            <f:facet name="title">
                Recuperação de Senha
            </f:facet>

            <p:inputText label="Email" title="Email" placeholder="Email" styleClass="col-md-12 m-3" type="email"
                         value="#{recuperacaoSenhaForm.email}" required="required"/>
            <div class="col-md-6"></div>
            <p:outputLabel styleClass="error col-md-12" value="#{recuperacaoSenhaForm.mensagem}"
                           rendered="#{recuperacaoSenhaForm.falhou}"/>

            <f:facet name="footer">
                <div class="d-flex justify-content-center ">
                    <p:commandButton value="Solicitar" onclick="spinner()"
                                     action="#{recuperacaoSenhaBean.solicitarRecuperacaoDeSenha}"/>
                    <div class="loader">
                        <div class="loading">
                        </div>
                    </div>
                </div>

            </f:facet>
        </p:card>

        <p:card styleClass="row d-flex justify-content-center align-content-center mt-5" rendered="#{recuperacaoSenhaForm.enviouCodigo and !recuperacaoSenhaForm.codigoValido}">

            <f:facet name="title">
                Valide o Código recebido no email
            </f:facet>

            <p:inputMask label="Código de Recuperação" title="Código de Recuperação" placeholder="Código de Recuperação" styleClass="col-md-12 m-3" mask="999999"
                         value="#{recuperacaoSenhaForm.codigoRecuperacao}" required="required"/>
            <div class="col-md-6"></div>
            <p:outputLabel styleClass="col-md-12" value="#{recuperacaoSenhaForm.mensagem}"
                           rendered="#{recuperacaoSenhaForm.enviouCodigo}"/>

            <f:facet name="footer">
                <div class="d-flex justify-content-center ">
                    <p:commandButton value="Validar"
                                     action="#{recuperacaoSenhaBean.validarCodigo}"/>
                </div>
            </f:facet>
        </p:card>

        <p:card styleClass="row d-flex justify-content-center align-content-center mt-5" rendered="#{recuperacaoSenhaForm.codigoValido}">

            <f:facet name="title">
                Altere a sua senha
            </f:facet>

                        <p:inputText label="Senha" pattern="(?=.*\d)(?=.*[a-z]).{8,}"
                                     title="Deve conter pelo menos um número e uma letra maiúscula, minúscula e pelo menos 8 ou mais caracteres"
                                     placeholder="Senha" styleClass="col-md-5 m-3" type="password" value="#{recuperacaoSenhaForm.senha}"
                                     required="required"
                                     id="password"
                                     name="password"/>

                        <p:inputText label="Confirmação de Senha" pattern="(?=.*\d)(?=.*[a-z]).{8,}"
                                     title="Deve conter pelo menos um número e uma letra maiúscula, minúscula e pelo menos 8 ou mais caracteres"
                                     placeholder="Confirmação de Senha" styleClass="col-md-5 m-3" type="password"
                                     value="#{recuperacaoSenhaForm.confirmacaoSenha}"
                                     required="required"
                                     id="passwordconfirm"
                                     name="passwordconfirm"/>
            <div class="col-md-6"></div>
            <p:outputLabel styleClass="col-md-12" value="#{recuperacaoSenhaForm.mensagem}"
                           rendered="#{recuperacaoSenhaForm.falhou}"/>

            <f:facet name="footer">
                <div class="d-flex justify-content-center ">
                    <p:commandButton value="Alterar a Senha"
                                     action="#{recuperacaoSenhaBean.alterarSenha}"/>
                </div>
            </f:facet>
        </p:card>


    </h:form>
</f:view>

<script type="text/javascript">
    function spinner() {
        document.getElementsByClassName("loader")[0].style.display = "block";
    }
</script>

</html>


